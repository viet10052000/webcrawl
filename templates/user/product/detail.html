{% extends 'user/layout/base.html' %}
{% block content %}
<!--====== App Content ======-->
        <div class="app-content">

          <!--====== Section 1 ======-->
          <div class="u-s-p-t-90">
              <div class="container">
                <div class="pd-breadcrumb u-s-m-b-30">
                    <ul class="pd-breadcrumb__list">
                        <li class="has-separator">
                            <a href="/" style="font-size:18px">Trang Chủ</a></li>
                        <li class="has-separator">
                            <a href="/home/product" style="font-size:18px">Sản Phẩm</a></li>
                        <li class="is-marked">
                        <a style="font-size:18px">{{product.name}}</a></li>
                    </ul>
                </div>
                  <div class="row">
                      <div class="col-lg-7">
                          <!--====== Product Detail Zoom ======-->
                          <div class="pd u-s-m-b-30">
                              <div class="pd-wrap">
                                  <div id="pd-o-initiate">
                                      <div class="pd-o-img-wrap">
                                        {% if product.link_image %}
                                        <img
                                          class="u-img-fluid"
                                          src="{{product.link_image}}"
                                          style="height: 300px;object-fit:contain;"
                                          alt=""
                                      />
                                      {% else %}
                                      <img
                                      class="u-img-fluid"
                                      src="{{ url_for('static',filename='/image_default.jpg') }}"
                                      style="height: 300px;object-fit:contain;"
                                      alt=""
                                  />
                                      {% endif %}
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <!--====== End - Product Detail Zoom ======-->
                      </div>
                      <div class="col-lg-5">

                          <!--====== Product Right Side Details ======-->
                          <div class="pd-detail" style="margin-top: 75px;">
                              <div>

                                  <span class="pd-detail__name">{{product.name}}</span></div>
                              <div>
                                  <div class="pd-detail__inline">

                                      <span class="pd-detail__price">{% if product.price != '0' %}{{product.price}} VNĐ{% else %}Sắp về hàng{% endif %}</span>
                              </div>
                              {% if productdetail.total_rating != 0 %}
                              <div class="pd-detail__inline">

                                <span class="product-o__price" style="color: #c99c18;">
                                  rating: {{productdetail.rating}} | {{productdetail.total_rating}}
                                </span>
                              </div>
                              {% endif %}
                              <div>
                                <img width="50" height="20" src="{{product.store.link_image}}" />
                                <span style="color:grey">{{ product.store.name }}</span>
                              </div>
                              <div class="u-s-m-b-15" style="margin-top:10px">
                                  <div class="pd-detail__inline">

                                      <span class="pd-detail__click-wrap"><svg style="width:14px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M364.2 83.8c-24.4-24.4-64-24.4-88.4 0l-184 184c-42.1 42.1-42.1 110.3 0 152.4s110.3 42.1 152.4 0l152-152c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-152 152c-64 64-167.6 64-231.6 0s-64-167.6 0-231.6l184-184c46.3-46.3 121.3-46.3 167.6 0s46.3 121.3 0 167.6l-176 176c-28.6 28.6-75 28.6-103.6 0s-28.6-75 0-103.6l144-144c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-144 144c-6.7 6.7-6.7 17.7 0 24.4s17.7 6.7 24.4 0l176-176c24.4-24.4 24.4-64 0-88.4z"/></svg></i>

                                          <a href="{{product.link_url}}" style="font-size:18px" target="_blank">Đi đến nơi bán</a>

                              </div>
                              <div class="u-s-m-b-15" style="margin-top:10px">
                                  <span>Chia sẻ lên : </span>
                                  <ul class="pd-social-list">
                                      <li>

                                          <a title="facebook" class="s-fb--color-hover" href="https://www.facebook.com/sharer/sharer.php?u={{product.link_url}}" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                                      <li>

                                          <a title="twitter" class="s-tw--color-hover" href="https://twitter.com/intent/tweet?url={{product.link_url}}" target="_blank"><i class="fab fa-twitter"></i></a></li>
                                      <li>

                                          <a title="instagram" class="s-insta--color-hover" href="https://www.instagram.com/sharer/sharer.php?u={{product.link_url}}" target="_blank"><i class="fab fa-instagram"></i></a></li>
                                      <li>

                                          <a title="whatsapp" class="s-wa--color-hover" href="whatsapp://send?text=Hãy kiểm tra trang web này: {{product.link_url}}" target="_blank"><i class="fab fa-whatsapp"></i></a></li>
                                  </ul>
                              </div>
                          </div>
                          <!--====== End - Product Right Side Details ======-->
                      </div>
                  </div>
              </div>
          </div>

          <!--====== Product Detail Tab ======-->
          <div id="content">
              <div class="container">
                  <div class="row">
                      <div class="col-lg-12">
                          <div class="pd-tab">
                              <div class="u-s-m-b-30">
                                  <ul class="nav pd-tab__list">
                                      <li class="nav-item">

                                          <a class="nav-link active" data-toggle="tab" href="#pd-desc">Thông Tin Sản Phẩm</a></li>
                                      <li class="nav-item">

                                          <a class="nav-link" data-toggle="tab" href="#pd-tag">Thông Số Kỹ Thuật</a></li>
                                      <li class="nav-item">

                                            <a class="nav-link" data-toggle="tab" href="#pd-price">Lịch sử giá</a></li>
                                  </ul>
                              </div>
                              <div class="tab-content">

                                  <!--====== Tab 1 ======-->
                                  <div class="tab-pane fade show active" id="pd-desc">
                                      <div>
                                          <div class="u-s-m-b-15">
                                            <p class="gl-scroll" style="font-size:18px;height: 400px;overflow-y: scroll;">{{productdetail.description}}</p>
                                          </div>
                                      </div>
                                  </div>
                                  <!--====== End - Tab 1 ======-->


                                  <!--====== Tab 2 ======-->
                                  <div class="tab-pane" id="pd-tag">
                                      <div>
                                          <div class="u-s-m-b-15">
                                            <div class="pd-table gl-scroll" style="height: 400px;overflow-y: scroll;">
                                                <table>
                                                    <tbody>
                                                        {% for key, value in productdetail.introduction.items()  %}
                                                        <tr>
                                                            <td>{{key}}</td>
                                                            <td>{{value}}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                      </div>
                                  </div>
                                  <!--====== End - Tab 2 ======-->
                                  <div class="tab-pane" id="pd-price">
                                    <div>
                                        <div class="u-s-m-b-15">
                                          <canvas id="myChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-12">

              <!--====== Section Intro ======-->
              <div class="section__intro u-s-m-t-46">
                  <div class="container">
                      <div class="row">
                          <div class="col-lg-12">
                              <div class="section__text-wrap">
                                  <h1 class="section__heading u-c-secondary u-s-m-b-12">Sản phẩm cùng tầm giá</h1>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <!--====== End - Section Intro ======-->


              <!--====== Section Content ======-->
              <div class="section__content">
                  <div class="container">
                      <div class="slider-fouc">
                          <div class="owl-carousel product-slider" data-item="4">
                            {% for item in similar_product %}
                              <div class="u-s-m-b-30">
                                  <a href="/home/product/detail/{{item._id}}" class="product-o">
                                      <div class="product-o__wrap">
                                          <a class="aspect aspect--square u-d-block" >
                                            {% if item.link_image %}
                                                <img width="300" height="200" class="aspect__img" src="{{item.link_image}}" alt="">
                                            {% else %}
                                                <img width="300" height="200" class="aspect__img" src="{{ url_for('static',filename='/image_default.jpg') }}" alt="">
                                            {% endif %}
                                          </a>
                                      </div>
                                      <div style="display:flex;margin-top:10px">
                                        <img style="width:50px;height:20px;" src="{{item.store.link_image}}" />
                                        <span style="color:grey">{{ item.store.name }}</span>
                                      </div>
                                      <div style="color: black;"><a href="/home/product/detail/{{item._id}}" style="color: black;height: 100px;">{{item.name}}</a></div>
                                      <span class="product-o__price" style="color: red;">
                                        {% if item.price != '0' %}{{item.price}} VNĐ{% else %}Sắp về hàng{% endif %}
                                      </span>
                                    </a>
                              </div>
                            {% endfor %}
                          </div>
                      </div>
                  </div>
              </div>
              <!--====== End - Section Content ======-->
          </div>
          <!--====== End - Section 1 ======-->
      </div>
      <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"
      ></script>
      <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
      integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
      ></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.9/dayjs.min.js" integrity="sha512-q4Xn+ZU2K+dqJPL8a3TiyGsDa31IkR/rLt/w+fy8jLrx8TdXj0dLM1Aq4aPXnOOKxHEya/bD9DePDB2DHm4jJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

      <script>
        let data = []
        const api_get_price_history = async () => {
            await $.ajax({
              type: "GET",
              url: '/api/product/detail/{{product._id}}',
              success: function (response) {
                data = response
                console.log(data)
              },
              error: function (error) {
                console.log(error)
              },
            });
            let price = []
            let labels = []
            data.map(item => {
                price.push(item.price)
                time = dayjs(item.created_at.$date ? item.created_at.$date : item.created_at).format('MM/DD')
                labels.push(time)
            })
            const ctx = document.getElementById('myChart');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.reverse(),
                    datasets: [{
                    label: 'biểu đồ lịch sử giá',
                    data: price.reverse(),
                    borderWidth: 1,
                    borderColor: 'red',
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
              });
            }
        $(document).ready(function () {
            api_get_price_history() 
        });
      </script>
{% endblock %}